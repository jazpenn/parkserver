function time_format(a){a=parseInt(a);var b=parseInt(a/60),c=a%60;return b=10>b?"0"+b:b,c=10>c?"0"+c:c,b+":"+c}function progress_bar_click_progress(a,b){return(a.clientX-b.offset().left)/b.width()}$(function(){video_width=$("#video_player").width(),origin_width=330,origin_height=186,player_height=video_width/origin_width*origin_height,video_player=videojs("video_player",{height:player_height,autoplay:!0,controls:!1,flash:{swf:"/static/video-js.swf"}}),$("#video_player").bind("contextmenu",function(){return!1}),$("#video_play_board .rotate_btn").insertAfter("#video_player video"),$("#video_player").hover(function(){$("#video_play_board .rotate_btn").stop().fadeIn()},function(){$("#video_play_board .rotate_btn").fadeOut(3800)}),html5_video_player=$("#video_player video");var a="height",b=90;$("#video_play_board .rotate_btn").click(function(){"height"==a?(html5_video_player.css("width",html5_video_player.height()).addClass("html5_video_center"),a="width"):(html5_video_player.removeAttr("style").removeClass("html5_video_center"),a="height"),html5_video_player.css("transform","rotate("+b+"deg)"),b+=90,b%=360}),video_player.on("fullscreenchange",function(){html5_video_player.removeAttr("style").removeClass("html5_video_center"),a="height",b=90}),window.screen.availWidth<992&&video_player.controls(!0),$("#danmaku_and_player").height(player_height),CM=new CommentManager(document.getElementById("danmaku_container")),CM.init(),Vue.config.delimiters=["[[","]]"],new_controls=new Vue({el:"#new_controls",data:{video_id:null,danmaku_text:null,progress_loaded:0,progress_played:0,is_playing:!0,no_voice:!1,volume_value:.38,video_total_time:0,video_cur_time_str:"00:00",video_total_time_str:"00:00",video_progress_bar:$("#video_progress_bar"),voice_progress_bar:$("#voice_progress_bar"),text_size:24,danmu_type:1,cur_color:16777215,font_block:$("#font_block"),hot_block:$("#hot_block"),danmaku_input:$("#danmaku_input"),fonts:[],types:[],colors:[],hots:[]},methods:{play_click:function(){video_player.play(),new_controls.is_playing=!0},pause_click:function(){video_player.pause(),new_controls.is_playing=!1,CM.stop()},voice_click:function(){new_controls.no_voice?(video_player.volume(new_controls.volume_value),new_controls.no_voice=!1):(video_player.volume(0),new_controls.no_voice=!0)},input_focus:function(){new_controls.font_block.hide(),new_controls.hot_block.hide()},progressbar_click:function(a){video_player.currentTime(progress_bar_click_progress(a,new_controls.video_progress_bar)*new_controls.video_total_time)},voicebar_click:function(a){new_controls.volume_value=progress_bar_click_progress(a,new_controls.voice_progress_bar),video_player.volume(new_controls.volume_value)},full_screen_click:function(){video_player.requestFullscreen()},send_danmaku:function(){if(new_controls.danmaku_text){var a=video_player.currentTime(),b=video_player.duration(),c=a==b?b-1:a;$.post("/api/video/danmu/new",{video_id:new_controls.video_id,content:new_controls.danmaku_text,time:c,danmu_type:new_controls.danmu_type,text_size:new_controls.text_size,color:new_controls.cur_color},function(a){new_controls.danmaku_text="",CM.send(a.danmu)})}},font_block_ctl:function(){new_controls.font_block.toggle(),new_controls.hot_block.hide()},hot_block_ctl:function(){new_controls.hot_block.toggle(),new_controls.font_block.hide()},font_click:function(a){console.log(a.value),new_controls.text_size=a.value},type_click:function(a){console.log(a.value),new_controls.danmu_type=new_controls.danmu_type==a.value?1:a.value},color_click:function(a){console.log(a.value,new_controls.cur_color),new_controls.cur_color=a.value},hot_click:function(a){new_controls.danmaku_text=a.words,new_controls.hot_block.toggle(),new_controls.danmaku_input.focus()}}}),video_player.on("play",function(){CM.start()}),video_player.on("timeupdate",function(){var a=video_player.currentTime();CM.time(a),new_controls.video_cur_time_str=time_format(a),new_controls.progress_played=100*(a/new_controls.video_total_time),100==new_controls.progress_played&&(new_controls.is_playing=!1),new_controls.video_total_time||(new_controls.video_total_time=video_player.duration(),new_controls.video_total_time_str=time_format(new_controls.video_total_time))}),video_player.on("loadedmetadata",function(){new_controls.video_total_time=video_player.duration(),new_controls.video_total_time_str=time_format(new_controls.video_total_time)}),video_player.on("loadeddata",function(){new_controls.progress_loaded=100*video_player.bufferedPercent()}),video_player.on("loadedalldata",function(){new_controls.progress_loaded=100*video_player.bufferedPercent()})});